# 面向对象设计思想
#### 目录介绍
- 01.一些基础的概念
- 02.面向对象四大特性
- 03.面向对象和过程
- 04.抽象类和接口对比
- 05.基于接口而非实现编程
- 06.多用组合少继承


### 01.一些基础的概念
- 面向对象的四大特性：
    - 封装、抽象、继承、多态。
- 面向对象编程 VS 面向对象编程语言
    - 面向对象编程中有两个非常重要、非常基础的概念，那就是类（class）和对象（object），大部分编程语言都是面向对象编程语言。
    - 面向对象编程是一种编程范式或编程风格。它以类或对象作为组织代码的基本单元，并将封装、抽象、继承、多态四个特性，作为代码设计和实现的基石 。
    - 面向对象编程语言是支持类或对象的语法机制，并有现成的语法机制，能方便地实现面向对象编程四大特性（封装、抽象、继承、多态）的编程语言。
- 如何判定一个编程语言是否是面向对象编程语言？
    - 如果按照严格的的定义，需要有现成的语法支持类、对象、四大特性才能叫作面向对象编程语言。
    - 如果放宽要求的话，只要某种编程语言支持类、对象语法机制，那基本上就可以说这种编程语言是面向对象编程语言，不一定非得要求具有所有的四大特性。



### 02.面向对象四大特性
#### 2.1 封装的特性
- 什么是封装的特性
    - 封装也叫作信息隐藏或者数据访问保护。类通过暴露有限的访问接口，授权外部仅能通过类提供的方式（或者叫函数）来访问内部信息或者数据。
- 封装的意义是什么？它能解决什么编程问题？
    - 如果我们对类中属性的访问不做限制，那任何代码都可以访问、修改类中的属性，虽然这样看起来更加灵活，但从另一方面来说，过度灵活也意味着不可控，属性可以随意被以各种奇葩的方式修改，而且修改逻辑可能散落在代码中的各个角落，势必影响代码的可读性、可维护性。
    - 类仅仅通过有限的方法暴露必要的操作，也能提高类的易用性。
- 封装还可以减少外部调用错误的概率
    - 将属性封装起来，暴露少许的几个必要的方法给调用者使用，调用者就不需要了解太多背后的业务细节，用错的概率就减少很多。
    - 这就好比，如果一个冰箱有很多按钮，你就要研究很长时间，还不一定能操作正确。相反，如果只有几个必要的按钮，比如开、停、调节温度，你一眼就能知道该如何来操作，而且操作出错的概率也会降低很多。



#### 2.2 抽象思想
- 什么是抽象特性
    - 封装主要讲的是如何隐藏信息、保护数据，而抽象讲的是如何隐藏方法的具体实现，让调用者只需要关心方法提供了哪些功能，并不需要知道这些功能是如何实现的。
    - 常借助编程语言提供的接口类（比如 Java 中的 interface 关键字语法）或者抽象类（比如 Java 中的 abstract 关键字语法）这两种语法机制，来实现抽象这一特性。
- 对于抽象这个特性，举一个例子来进一步解释一下。
    - 利用 Java 中的 interface 接口语法来实现抽象特性。调用者在使用图片存储功能的时候，只需要了解 IPictureStorage 这个接口类暴露了哪些方法就可以了，不需要去查看 PictureStorage 类里的具体实现逻辑。
    ``` java
    public interface IPictureStorage {
      void savePicture(Picture picture);
      Image getPicture(String pictureId);
      void deletePicture(String pictureId);
      void modifyMetaInfo(String pictureId, PictureMetaInfo metaInfo);
    }
    
    public class PictureStorage implements IPictureStorage {
      // ...省略其他属性...
      @Override
      public void savePicture(Picture picture) { ... }
      @Override
      public Image getPicture(String pictureId) { ... }
      @Override
      public void deletePicture(String pictureId) { ... }
      @Override
      public void modifyMetaInfo(String pictureId, PictureMetaInfo metaInfo) { ... }
    }
    ```
- 抽象这个概念是一个非常通用的设计思想
    - 不单单用在面向对象编程中，也可以用来指导架构设计等。而且这个特性也并不需要编程语言提供特殊的语法机制来支持，只需要提供“函数”这一非常基础的语法机制，就可以实现抽象特性、所以，它没有很强的“特异性”，有时候并不被看作面向对象编程的特性之一。
- 抽象的意义是什么？它能解决什么编程问题？
    - 一方面是提高代码的可扩展性、维护性，修改实现不需要改变定义，减少代码的改动范围；另一方面，它也是处理复杂系统的有效手段，能有效地过滤掉不必要关注的信息。


#### 2.3 继承特性
- 关于继承特性
    - 继承是用来表示类之间的 is-a 关系，分为两种模式：单继承和多继承。单继承表示一个子类只继承一个父类，多继承表示一个子类可以继承多个父类。
    - 为了实现继承这个特性，编程语言需要提供特殊的语法机制来支持。继承主要是用来解决代码复用的问题。
- 关于继承复用代码讨论
    - 如果我们有两个类 A 和 B，它们要用到一块相同的功能逻辑，为了避免代码重复不应该在两个类中，将这个相同的功能逻辑，重复地实现两遍。这个时候我们该怎么办呢？
    - 利用继承特性，我们把相同的属性和方法，抽取出来，定义到父类中。子类复用父类中的属性和方法，达到代码复用的目的。
    - 如何A和B既不是父子关系，也不是兄弟关系，仅仅为了代码复用，生硬地抽象出一个父类C出来，会影响到代码的可读性。这时候可以抽取为Utils类。



#### 2.4 多态特性



### 03.面向对象和过程
#### 3.1 看一个代码案例
- 首先，我们先来看，用面向过程这种编程风格写出来的代码是什么样子的。注意，下面的代码是用 C 语言这种面向过程的编程语言来编写的。
    ```c
    struct User {
      char name[64];
      int age;
      char gender[16];
    };
    
    struct User parse_to_user(char* text) {
      // 将text(“小王&28&男”)解析成结构体struct User
    }
    
    char* format_to_text(struct User user) {
      // 将结构体struct User格式化成文本（"小王\t28\t男"）
    }
    
    void sort_users_by_age(struct User users[]) {
      // 按照年龄从小到大排序users
    }
    
    void format_user_file(char* origin_file_path, char* new_file_path) {
      // open files...
      struct User users[1024]; // 假设最大1024个用户
      int count = 0;
      while(1) { // read until the file is empty
        struct User user = parse_to_user(line);
        users[count++] = user;
      }
      
      sort_users_by_age(users);
      
      for (int i = 0; i < count; ++i) {
        char* formatted_user_text = format_to_text(users[i]);
        // write to new file...
      }
      // close files...
    }
    
    int main(char** args, int argv) {
      format_user_file("/home/zheng/user.txt", "/home/zheng/formatted_users.txt");
    }
    ```
- 再来看，用面向对象这种编程风格写出来的代码是什么样子的。注意，下面的代码是用 Java 这种面向对象的编程语言来编写的。
    ```java
     public class User {
      private String name;
      private int age;
      private String gender;
      
      public User(String name, int age, String gender) {
        this.name = name;
        this.age = age;
        this.gender = gender;
      }
      
      public static User praseFrom(String userInfoText) {
        // 将text(“小王&28&男”)解析成类User
      }
      
      public String formatToText() {
        // 将类User格式化成文本（"小王\t28\t男"）
      }
    }
    
    public class UserFileFormatter {
      public void format(String userFile, String formattedUserFile) {
        // Open files...
        List users = new ArrayList<>();
        while (1) { // read until file is empty 
          // read from file into userText...
          User user = User.parseFrom(userText);
          users.add(user);
        }
        // sort users by age...
        for (int i = 0; i < users.size(); ++i) {
          String formattedUserText = user.formatToText();
          // write to new file...
        }
        // close files...
      }
    }
    
    public class MainApplication {
      public static void main(Sring[] args) {
        UserFileFormatter userFileFormatter = new UserFileFormatter();
        userFileFormatter.format("/home/zheng/users.txt", "/home/zheng/formatted_users.txt");
      }
    }
    ```
- 从上面的代码中，可以看出，面向过程和面向对象最基本的区别就是，代码的组织方式不同。
    - 面向过程风格的代码被组织成了一组方法集合及其数据结构（struct User），方法和数据结构的定义是分开的。
    - 面向对象风格的代码被组织成一组类，方法和数据结构被绑定一起，定义在类中。


#### 3.2 理解面向过程
- 什么是面向过程编程？什么是面向过程编程语言？
    - 实际上，面向过程编程和面向过程编程语言并没有严格的官方定义。理解这两个概念最好的方式是跟面向对象编程和面向对象编程语言进行对比。
    - 相较于面向对象编程以类为组织代码的基本单元，面向过程编程则是以过程（或方法）作为组织代码的基本单元。它最主要的特点就是数据和方法相分离。相较于面向对象编程语言，面向过程编程语言最大的特点就是不支持丰富的面向对象编程特性，比如继承、多态、封装。


#### 3.3 面向对象优势
- 面向对象编程相比面向过程编程有哪些优势？面向对象编程相比起面向过程编程的优势主要有三个。
    - 对于大规模复杂程序的开发，程序的处理流程并非单一的一条主线，而是错综复杂的网状结构。面向对象编程比起面向过程编程，更能应对这种复杂类型的程序开发。
    - 面向对象编程相比面向过程编程，具有更加丰富的特性（封装、抽象、继承、多态）。利用这些特性编写出来的代码，更加易扩展、易复用、易维护。
    - 从编程语言跟机器打交道的方式的演进规律中，可以总结出：面向对象编程语言比起面向过程编程语言，更加人性化、更加高级、更加智能。


#### 3.4 滥用面向对象
- 面向对象封装的定义是：
    - 通过访问权限控制，隐藏内部数据，外部仅能通过类提供的有限的接口访问、修改内部数据。
- 从表面上看似是面向对象编程风格的代码，从本质上看却是面向过程编程风格的。
    - 滥用getter和setter方法：给每个属性都定义 getter、setter 方法的时候，它违反了面向对象编程的封装特性，相当于将面向对象编程风格退化成了面向过程编程风格。



### 04.抽象类和接口对比
- 抽象类和接口的语法特性
    - 抽象类不允许被实例化，只能被继承。它可以包含属性和方法。方法既可以包含代码实现，也可以不包含代码实现。不包含代码实现的方法叫作抽象方法。子类继承抽象类，必须实现抽象类中的所有抽象方法。
    - 接口不能包含属性，只能声明方法，方法不能包含代码实现。类实现接口的时候，必须实现接口中声明的所有方法。
- 抽象类和接口存在的意义
    - 抽象类是对成员变量和方法的抽象，是一种 is-a 关系，是为了解决代码复用问题。
    - 接口仅仅是对方法的抽象，是一种 has-a 关系，表示具有某一组行为特性，是为了解决解耦问题，隔离接口和具体的实现，提高代码的扩展性。
- 抽象类和接口的应用场景区别
    - 什么时候该用抽象类？什么时候该用接口？实际上，判断的标准很简单。
    - 如果要表示一种 is-a 的关系，并且是为了解决代码复用问题，我们就用抽象类；如果要表示一种 has-a 关系，并且是为了解决抽象而非代码复用问题，那我们就用接口。
    - 从类的继承层次上来看，抽象类是一种自下而上的设计思路，先有子类的代码重复，然后再抽象成上层的父类（也就是抽象类）。
    - 而接口正好相反，它是一种自上而下的设计思路。我们在编程的时候，一般都是先设计接口，再去考虑具体的实现。


### 05.基于接口而非实现编程
- 如何理解基于接口而非实现编程
    - 理解其中的“接口”两个字。从本质上来看，“接口”就是一组“协议”或者“约定”，是功能提供者提供给使用者的一个“功能列表”。
    - 如果落实到具体的编码，“基于接口而非实现编程”这条原则中的“接口”，可以理解为编程语言中的接口或者抽象类。
- 这条准则能提高代码质量
    - 可以将接口和实现相分离，封装不稳定的实现，暴露稳定的接口。上游系统面向接口而非实现编程，不依赖不稳定的实现细节，这样当实现发生变化的时候，上游系统的代码基本上不需要做改动，以此来降低耦合性，提高扩展性。
- 在做软件开发的时候，一定要有抽象意识、封装意识、接口意识。
    - 在定义接口的时候，不要暴露任何实现细节。接口的定义只表明做什么，而不是怎么做。而且，在设计接口的时候，要多思考一下，这样的接口设计是否足够通用，是否能够做到在替换具体的接口实现的时候，不需要任何接口定义的改动。



### 06.多用组合少继承
#### 6.1 为何不推荐使用继承
- 继承是面向对象的四大特性之一，用来表示类之间的 is-a 关系，可以解决代码复用的问题。
    - 虽然继承有诸多作用，但继承层次过深、过复杂，也会影响到代码的可维护性。所以，对于是否应该在项目中使用继承，网上有很多争议。
    - 很多人觉得继承是一种反模式，应该尽量少用，甚至不用。为什么会有这样的争议？
- 假设我们要设计一个关于鸟的类。我们将“鸟类”这样一个抽象的事物概念，定义为一个抽象类 AbstractBird。
    - 所有更细分的鸟，比如麻雀、鸽子、乌鸦等，都继承这个抽象类。大部分鸟都会飞，那我们可不可以在 AbstractBird 抽象类中，定义一个 fly() 方法呢？
    - 答案是否定的。尽管大部分鸟都会飞，但也有特例，比如鸵鸟就不会飞。鸵鸟继承具有 fly() 方法的父类，那鸵鸟就具有“飞”这样的行为，这显然不符合我们对现实世界中事物的认识。
    - 因为除了鸵鸟之外，不会飞的鸟还有很多，比如企鹅。对于这些不会飞的鸟来说，都需要重写 fly() 方法，抛出异常。这样的设计，一方面，徒增了编码的工作量；另一方面，也违背了最小知识原则（Least Knowledge Principle，也叫最少知识原则或者迪米特法则），暴露不该暴露的接口给外部，增加了类使用过程中被误用的概率。


#### 6.2 继承存在一定问题
- 类的继承层次会越来越深、继承关系会越来越复杂。
    - 而这种层次很深、很复杂的继承关系，一方面，会导致代码的可读性变差。因为我们要搞清楚某个类具有哪些方法、属性，必须阅读父类的代码、父类的父类的代码……一直追溯到最顶层父类的代码。
    - 另一方面，这也破坏了类的封装特性，将父类的实现细节暴露给了子类。子类的实现依赖父类的实现，两者高度耦合，一旦父类代码修改，就会影响所有子类的逻辑。
- 继承最大的问题就在于：
    - 继承层次过深、继承关系过于复杂会影响到代码的可读性和可维护性。这也是为什么不推荐使用继承。那刚刚例子中继承存在的问题，又该如何来解决呢?



#### 6.3 组合VS继承
- 1.为什么不推荐使用继承？
    - 继承是面向对象的四大特性之一，用来表示类之间的 is-a 关系，可以解决代码复用的问题。虽然继承有诸多作用，但继承层次过深、过复杂，也会影响到代码的可维护性。在这种情况下，我们应该尽量少用，甚至不用继承。
- 2.组合相比继承有哪些优势？
    - 继承主要有三个作用：表示 is-a 关系，支持多态特性，代码复用。而这三个作用都可以通过组合、接口、委托三个技术手段来达成。除此之外，利用组合还能解决层次过深、过复杂的继承关系影响代码可维护性的问题。
- 3.如何判断该用组合还是继承？
    - 尽管我们鼓励多用组合少用继承，但组合也并不是完美的，继承也并非一无是处。在实际的项目开发中，我们还是要根据具体的情况，来选择该用继承还是组合。
    - 如果类之间的继承结构稳定，层次比较浅，关系不复杂，我们就可以大胆地使用继承。反之，我们就尽量使用组合来替代继承。除此之外，还有一些设计模式、特殊的应用场景，会固定使用继承或者组合。




















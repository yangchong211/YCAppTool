#### åŸºç¡€ä½¿ç”¨ç›®å½•ä»‹ç»
- 01.å¤„ç†é”™è¯¯å›è°ƒæœ‰é‚£äº›
- 02.onReceivedHttpError
- 03.onReceivedSslError
- 04.onReceivedError




### 01.å¤„ç†é”™è¯¯å›è°ƒæœ‰é‚£äº›
- å¯¹äºWebViewåŠ è½½ä¸€ä¸ªç½‘é¡µè¿‡ç¨‹ä¸­æ‰€äº§ç”Ÿçš„é”™è¯¯å›è°ƒï¼Œå¤§è‡´æœ‰ä¸‰ç§ï¼š
    - onReceivedHttpError
    - onReceivedSslError
    - onReceivedError



### 02.onReceivedHttpError
- ä»»ä½•HTTPè¯·æ±‚äº§ç”Ÿçš„é”™è¯¯éƒ½ä¼šå›è°ƒè¿™ä¸ªæ–¹æ³•ï¼ŒåŒ…æ‹¬ä¸»é¡µé¢çš„htmlæ–‡æ¡£è¯·æ±‚ï¼Œiframeã€å›¾ç‰‡ç­‰èµ„æºè¯·æ±‚ã€‚
- åœ¨è¿™ä¸ªå›è°ƒä¸­ï¼Œç”±äºæ··æ‚äº†å¾ˆå¤šè¯·æ±‚ï¼Œä¸é€‚åˆç”¨æ¥å±•ç¤ºåŠ è½½é”™è¯¯çš„é¡µé¢ï¼Œè€Œé€‚åˆåšç›‘æ§æŠ¥è­¦ã€‚
- å½“æŸä¸ªURLï¼Œæˆ–è€…æŸä¸ªèµ„æºæ”¶åˆ°å¤§é‡æŠ¥è­¦æ—¶ï¼Œè¯´æ˜é¡µé¢æˆ–èµ„æºå¯èƒ½å­˜åœ¨é—®é¢˜ï¼Œè¿™æ—¶å€™å¯ä»¥è®©ç›¸å…³è¿è¥åŠæ—¶å“åº”ä¿®æ”¹ã€‚
    ```
    /**
     * é€šçŸ¥ä¸»æœºåº”ç”¨ç¨‹åºåœ¨åŠ è½½èµ„æºæ—¶ä»æœåŠ¡å™¨æ¥æ”¶åˆ°HTTPé”™è¯¯
     * @param view                              view
     * @param request                           requestï¼Œæ·»åŠ äºAPI21ï¼Œå°è£…äº†ä¸€ä¸ªWebèµ„æºçš„è¯·æ±‚ä¿¡æ¯ï¼Œ
     *                                          åŒ…å«ï¼šè¯·æ±‚åœ°å€ï¼Œè¯·æ±‚æ–¹æ³•ï¼Œè¯·æ±‚å¤´ï¼Œæ˜¯å¦ä¸»æ¡†æ¶ï¼Œæ˜¯å¦ç”¨æˆ·ç‚¹å‡»ï¼Œæ˜¯å¦é‡å®šå‘
     * @param errorResponse                     errorResponseï¼Œå°è£…äº†ä¸€ä¸ªWebèµ„æºçš„å“åº”ä¿¡æ¯ï¼Œ
     *                                          åŒ…å«ï¼šå“åº”æ•°æ®æµï¼Œç¼–ç ï¼ŒMIMEç±»å‹ï¼ŒAPI21åæ·»åŠ äº†å“åº”å¤´ï¼ŒçŠ¶æ€ç ä¸çŠ¶æ€æè¿°
     */
    @Override
    public void onReceivedHttpError(WebView view, WebResourceRequest request,
                                    WebResourceResponse errorResponse) {
        super.onReceivedHttpError(view, request, errorResponse);
    }
    ```



### 03.onReceivedSslError
- WebViewClient.onReceivedSslError(webview, sslErrorHandler, sslError)
- ä»»ä½•HTTPSè¯·æ±‚ï¼Œé‡åˆ°SSLé”™è¯¯æ—¶éƒ½ä¼šå›è°ƒè¿™ä¸ªæ–¹æ³•ã€‚æ¯”è¾ƒæ­£ç¡®çš„åšæ³•æ˜¯è®©ç”¨æˆ·é€‰æ‹©æ˜¯å¦ä¿¡ä»»è¿™ä¸ªç½‘ç«™ï¼Œè¿™æ—¶å€™å¯ä»¥å¼¹å‡ºä¿¡ä»»é€‰æ‹©æ¡†ä¾›ç”¨æˆ·é€‰æ‹©ï¼ˆå¤§éƒ¨åˆ†æ­£è§„æµè§ˆå™¨æ˜¯è¿™ä¹ˆåšçš„ï¼‰ã€‚ä½†äººéƒ½æ˜¯æœ‰ç§å¿ƒçš„ï¼Œä½•å†µæ˜¯é‡åˆ°è‡ªå®¶çš„ç½‘ç«™æ—¶ã€‚æˆ‘ä»¬å¯ä»¥è®©ä¸€äº›ç‰¹å®šçš„ç½‘ç«™ï¼Œä¸ç®¡å…¶è¯ä¹¦æ˜¯å¦å­˜åœ¨é—®é¢˜ï¼Œéƒ½è®©ç”¨æˆ·ä¿¡ä»»å®ƒã€‚
    ```
    @Override
    public void onReceivedSslError(WebView view, SslErrorHandler handler, SslError error) {
        if (UrlUtils.isKaolaHost(getUrl())) {
            handler.proceed();
        } else {
            super.onReceivedSslError(view, handler, error);
        }
    }
    ```


### 04.onReceivedError
- WebViewClient.onReceivedError(webView, webResourceRequest, webResourceError)
- åªæœ‰åœ¨ä¸»é¡µé¢åŠ è½½å‡ºç°é”™è¯¯æ—¶ï¼Œæ‰ä¼šå›è°ƒè¿™ä¸ªæ–¹æ³•ã€‚è¿™æ­£æ˜¯å±•ç¤ºåŠ è½½é”™è¯¯é¡µé¢æœ€åˆé€‚çš„æ–¹æ³•ã€‚ç„¶é¹…ï¼Œå¦‚æœä¸ç®¡ä¸‰ä¸ƒäºŒåä¸€ç›´æ¥å±•ç¤ºé”™è¯¯é¡µé¢çš„è¯ï¼Œé‚£å¾ˆæœ‰å¯èƒ½ä¼šè¯¯åˆ¤ï¼Œç»™ç”¨æˆ·é€ æˆç»å¸¸åŠ è½½é¡µé¢å¤±è´¥çš„é”™è§‰ã€‚ç”±äºä¸åŒçš„WebViewå®ç°å¯èƒ½ä¸ä¸€æ ·ï¼Œæ‰€ä»¥æˆ‘ä»¬é¦–å…ˆéœ€è¦æ’é™¤å‡ ç§è¯¯åˆ¤çš„ä¾‹å­ï¼š
    - åŠ è½½å¤±è´¥çš„urlè·ŸWebViewé‡Œçš„urlä¸æ˜¯åŒä¸€ä¸ªurlï¼Œæ’é™¤ï¼›
    - errorCode=-1ï¼Œè¡¨æ˜æ˜¯ERROR_UNKNOWNçš„é”™è¯¯ï¼Œä¸ºäº†ä¿è¯ä¸è¯¯åˆ¤ï¼Œæ’é™¤
    - failingUrl=null&errorCode=-12ï¼Œç”±äºé”™è¯¯çš„urlæ˜¯ç©ºè€Œä¸æ˜¯ERROR_BAD_URLï¼Œæ’é™¤
- ä»£ç å¦‚ä¸‹æ‰€ç¤º
    ```
    @Override
    public void onReceivedError(WebView view, int errorCode, String description, String failingUrl) {
        super.onReceivedError(view, errorCode, description, failingUrl);
    
        // -12 == EventHandle.ERROR_BAD_URL, a hide return code inside android.net.http package
        if ((failingUrl != null && !failingUrl.equals(view.getUrl()) && !failingUrl.equals(view.getOriginalUrl())) /* not subresource error*/
                || (failingUrl == null && errorCode != -12) /*not bad url*/
                || errorCode == -1) { //å½“ errorCode = -1 ä¸”é”™è¯¯ä¿¡æ¯ä¸º net::ERR_CACHE_MISS
            return;
        }
    
        if (!TextUtils.isEmpty(failingUrl)) {
            if (failingUrl.equals(view.getUrl())) {
                if (null != mIWebViewClient) {
                    mIWebViewClient.onReceivedError(view);
                }
            }
        }
    }
    ```



### 5.0.3 è‡ªå®šä¹‰åŠ è½½å¼‚å¸¸errorçš„çŠ¶æ€é¡µé¢ï¼Œæ¯”å¦‚ä¸‹é¢è¿™äº›æ–¹æ³•ä¸­å¯èƒ½ä¼šå‡ºç°error
- å½“WebViewåŠ è½½é¡µé¢å‡ºé”™æ—¶ï¼ˆä¸€èˆ¬ä¸º404 NOT FOUNDï¼‰ï¼Œå®‰å“WebViewä¼šé»˜è®¤æ˜¾ç¤ºä¸€ä¸ªå‡ºé”™ç•Œé¢ã€‚å½“WebViewåŠ è½½å‡ºé”™æ—¶ï¼Œä¼šåœ¨WebViewClientå®ä¾‹ä¸­çš„onReceivedError()ï¼Œè¿˜æœ‰onReceivedTitleæ–¹æ³•æ¥æ”¶åˆ°é”™è¯¯
    ```
    /**
     * è¯·æ±‚ç½‘ç»œå‡ºç°error
     * @param view                              view
     * @param errorCode                         é”™è¯¯ğŸ
     * @param description                       description
     * @param failingUrl                        å¤±è´¥é“¾æ¥
     */
    @Override
    public void onReceivedError(WebView view, int errorCode, String description, String
            failingUrl) {
        super.onReceivedError(view, errorCode, description, failingUrl);
        if (errorCode == 404) {
            //ç”¨javascriptéšè—ç³»ç»Ÿå®šä¹‰çš„404é¡µé¢ä¿¡æ¯
            String data = "Page NO FOUNDï¼";
            view.loadUrl("javascript:document.body.innerHTML=\"" + data + "\"");
        } else {
            if (webListener!=null){
                webListener.showErrorView();
            }
        }
    }
    
    // å‘ä¸»æœºåº”ç”¨ç¨‹åºæŠ¥å‘ŠWebèµ„æºåŠ è½½é”™è¯¯ã€‚è¿™äº›é”™è¯¯é€šå¸¸è¡¨æ˜æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨ã€‚
    // å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¸åŒçš„æ˜¯è¿‡æ—¶çš„ç‰ˆæœ¬çš„å›è°ƒï¼Œæ–°çš„ç‰ˆæœ¬å°†è¢«ç§°ä¸ºä»»ä½•èµ„æºï¼ˆiframeï¼Œå›¾åƒç­‰ï¼‰
    // ä¸ä»…ä¸ºä¸»é¡µã€‚å› æ­¤ï¼Œå»ºè®®åœ¨å›è°ƒè¿‡ç¨‹ä¸­æ‰§è¡Œæœ€ä½è¦æ±‚çš„å·¥ä½œã€‚
    // 6.0 ä¹‹å
    @Override
    public void onReceivedError(WebView view, WebResourceRequest request, WebResourceError error) {
        super.onReceivedError(view, request, error);
        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.M) {
            X5WebUtils.log("æœåŠ¡å™¨å¼‚å¸¸"+error.getDescription().toString());
        }
        //ToastUtils.showToast("æœåŠ¡å™¨å¼‚å¸¸6.0ä¹‹å");
        //å½“åŠ è½½é”™è¯¯æ—¶ï¼Œå°±è®©å®ƒåŠ è½½æœ¬åœ°é”™è¯¯ç½‘é¡µæ–‡ä»¶
        //mWebView.loadUrl("file:///android_asset/errorpage/error.html");
        if (webListener!=null){
            webListener.showErrorView();
        }
    }
    
    /**
     * è¿™ä¸ªæ–¹æ³•ä¸»è¦æ˜¯ç›‘å¬æ ‡é¢˜å˜åŒ–æ“ä½œçš„
     * @param view                              view
     * @param title                             æ ‡é¢˜
     */
    @Override
    public void onReceivedTitle(WebView view, String title) {
        super.onReceivedTitle(view, title);
        if (title.contains("404") || title.contains("ç½‘é¡µæ— æ³•æ‰“å¼€")){
            if (webListener!=null){
                webListener.showErrorView();
            }
        } else {
            // è®¾ç½®title
        }
    }
    ```




    
### 5.0.5 WebViewåŠ è½½è¯ä¹¦é”™è¯¯
- webViewåŠ è½½ä¸€äº›åˆ«äººçš„urlæ—¶å€™ï¼Œæœ‰æ—¶å€™ä¼šå‘ç”Ÿè¯ä¹¦è®¤è¯é”™è¯¯çš„æƒ…å†µï¼Œè¿™æ—¶å€™æˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿæ­£å¸¸çš„å‘ˆç°é¡µé¢ç»™ç”¨æˆ·ï¼Œæˆ‘ä»¬éœ€è¦å¿½ç•¥è¯ä¹¦é”™è¯¯ï¼Œéœ€è¦è°ƒç”¨WebViewClientç±»çš„onReceivedSslErroræ–¹æ³•ï¼Œè°ƒç”¨handler.proceed()æ¥å¿½ç•¥è¯¥è¯ä¹¦é”™è¯¯ã€‚
    ```
    /**
     * åœ¨åŠ è½½èµ„æºæ—¶é€šçŸ¥ä¸»æœºåº”ç”¨ç¨‹åºå‘ç”ŸSSLé”™è¯¯
     * ä½œç”¨ï¼šå¤„ç†httpsè¯·æ±‚
     * @param view                              view
     * @param handler                           handler
     * @param error                             error
     */
    @Override
    public void onReceivedSslError(WebView view, SslErrorHandler handler, SslError error) {
        super.onReceivedSslError(view, handler, error);
        if (error!=null){
            String url = error.getUrl();
            X5WebUtils.log("onReceivedSslError----å¼‚å¸¸url----"+url);
        }
        //httpså¿½ç•¥è¯ä¹¦é—®é¢˜
        if (handler!=null){
            //è¡¨ç¤ºç­‰å¾…è¯ä¹¦å“åº”
            handler.proceed();
            // handler.cancel();      //è¡¨ç¤ºæŒ‚èµ·è¿æ¥ï¼Œä¸ºé»˜è®¤æ–¹å¼
            // handler.handleMessage(null);    //å¯åšå…¶ä»–å¤„ç†
        }
    }
    ```









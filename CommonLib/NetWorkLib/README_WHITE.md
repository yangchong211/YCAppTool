# 网络工具库
#### 目录介绍
- 01.基础概念介绍
- 02.常见思路和做法
- 03.Api调用说明
- 04.遇到的坑分析
- 05.其他问题说明



### 01.基础概念说明


### 02.常见思路和做法
#### 2.4 如何白名单校验
- 处理白名单的步骤
    - 1.添加白名单，主要是添加host，通常添加到list集合中。这里主要存放白名单的链接……
    - 2.如何判断白名单，通过Uri解析url然后获取host检查，判断url是否在白名单集合中
- 方案1：使用错误校验方式
    - 通过indexOf简单校验
        - 校验逻辑来判断调用方的域名是否在白名单内，不过这个校验逻辑并没有他当初想象的那么简单。
    - 这种方式存在问题
        - 这个校验逻辑错误比较低级，攻击者直接输入http://www.rebeyond.net/poc.htm?site1.com就可以绕过了。
        - 因为URL中除了代表域名的字段外，还有路径、参数等和域名无关的字段，因此直接判断整个URL是不安全的。
        ```
        http://www.site2.com.rebeyond.net/poc.htm
        ```
        - 上述URL的host中包含site2.com字符串，但是www.site2.com并不是域名，而是rebeyond.net这个域名的一个子域名，所以最终还是指向了攻击者控制的服务器。
- 方案2：截取域名进行校验
    - 提取域名检验
        - 想要匹配白名单中的域名，首先应该把用户输入的URL中的域名提取出来再进行校验才对，使用字符串substring提取
    - 这种方式存在问题
        - 由于缺乏对URL语法的了解，错误的认为://和第一个/之间的字符串即为域名（host），导致了这个检测逻辑可以通过如下payload绕过。
        - 比如：http://site1.com@www.github.com/yangchong211，打开这个地址，发现竟然是github.com/yangchong211
        - RFC中对URL格式的描述：<protocol>://<user>:<password>@<host>:<port>/<url-path>
        - 攻击者利用URL不常见的语法，在URL中加入了Authority字段即绕过了这段校验。
        - Authority字段是用来向所请求的访问受限资源提供用户凭证的，比如访问一个需要认证的ftp资源，用户名为test，密码为123456，可以直接在浏览器中输入URL：ftp://test:123456@nju.edu.cn/。
- 方案3：格式化获取host检验
    - 实现URL的格式化
        - Uri.parse(url).getHost()，使用该种方式即可得到url真正的host地址
- 可以总结为如下几条开发建议：
    - 不要使用indexOf这种模糊匹配的函数；不要自己写正则表达式去匹配；
    - 尽量使用Java封装好的获取域名的方法，比如java.net.URI，不要使用java.net.URL；
    - 不仅要给域名设置白名单，还要给协议设置白名单，一般常用HTTP和HTTPS两种协议，不过强烈建议不要使用HTTP协议，因为移动互联网时代，手机被中间人攻击的门槛很低，搭一个恶意WiFi即可劫持手机网络流量；
    - 权限最小化原则，尽量使用更精确的域名或者路径。


### 03.Api调用说明



### 04.遇到的坑分析


### 05.其他问题说明





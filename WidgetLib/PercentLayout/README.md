# 百分比布局
#### 目录介绍
- 01.基础概念介绍
- 02.常见方案分析
- 03.常见思路做法
- 04.Api调用说明
- 05.遇到的坑分析
- 06.该库性能分析


### 01.基础概念介绍
#### 1.1 背景说明
- 项目开发中的痛点
  - 1.没有办法解决一套布局适配各种各样比例的屏幕。
  - 2.当使用图片时，谷歌百分比布局，无法设置宽高的比例。比如图片宽高是200*100的，在使用过程中我们设置宽高为20%、10%，这样会造成图片的比例失调。为什么呢？因为20%参考的是屏幕的宽度，而10%参考的是屏幕的高度。
  - 3.很难设置一个控件的margin或者padding四个方向值一致。设置margin，希望四边的边距一致的，但是如果目前设置5%，会造成，上下为高度的5%，左右边距为宽度的5%。


#### 1.2 需要支持功能
- 需要支持功能
  - 添加了PercentLinearLayout
  - 支持百分比指定特定的参考值，比如宽度或者高度。比如sw表示宽度，sh表示高度。
  - 对于外层套ScrollView的问题，目前可以在PercentLinearLayout的外层使用ScrollView，不过对于宽度的百分比参考的就是android.R.id.content的高度。
    - 因为，无法参考父控件的高度，父控件的高度理论上依赖于子View高度，且模式为UNSPECIFIED
  - 支持设置相同的padding。思路是拿到宽度或者高度某一个尺寸，设置上下左右比例【是以某个固定尺寸设置的，比如取短边】


#### 1.3 布局常规单位
- 布局常规单位
  - %，这个代表百分比的符号
  - 50%h，这个表示百分之五十的高度，以父容器为标准。
  - 15%w，这个表示百分之十五的宽度，以父容器为标准。
  - 50%sh，这个表示百分之五十的高度，以屏幕为标准。
  - 15%sw，这个表示百分之十五的宽度，以屏幕为标准。
- 要注意的点
  - 这个50%h，是相对布局根容器，还是相对父容器计算？



### 02.常见方案分析
#### 2.1 常见方案思路
- 方案1:今日头条屏幕适配方案
  - 一种单屏方案。通过强行修改系统的density(屏幕的像素密度比，越高占用的像素点越多，每台设备这个值是固定的)值，用于适配设计稿的尺寸，实现代码逻辑可以完全按照设计稿编写，达到跟设计稿一致的效果。
  - 实际可以看做是按照一定的百分比尺寸，对设计稿的显示效果按照一定的比例进行缩放。
- 方案2:values适配分辨率
  - 按照比例生成市面上对应分辨率的多个适配文件，以"values-需要适配的分辨率〃的格式对该文件夹进行命名，系统会加载指定分辨率或者就近选择最佳分辨率。
- 方案3:zhy百分比UI方案
  - 通过百分比参数可以在不同分辨率屏幕显示出相同的组件布局，组件的相对关系不会改变。实现原理就是根据屏幕真实尺寸等比例去计算控件的大小。



#### 2.2 方案分析说明
- 方案1存在的问题
  - 适配范围是不可控：因为density是全局性，一旦修改了，会导致系统控件和第三方控件也生效。
- 方案2存在的问题
  - 容易遗漏以及维护成本高：要一次性生成全部尺寸，可能不能完全覆盖市面上所有的尺寸，而且随着版本迭代，后面会新增，维护成本高。
- 方案3存在的问题
  - 变形问题：控件的宽高会在不同屏幕按照等比例缩放，一旦屏幕的长宽比不一致会出现变形的问题。



### 03.常见思路和做法
#### 3.1 百分比布局设计思路
- 如果你是谷歌设计者，你会怎么设计百分比布局
  - 第一步：定义布局常规的计算单位。分别有：屏幕宽，屏幕高。父容器宽，父容器高。还有百分比单位！
  - 第二步：罗列计算方式，15%w则需要计算宽度=父容器宽度*15%；15%sw则需要计算宽度=屏幕宽度*15%；
  - 第三步：在测量方法中，获取父容器尺寸，然后遍历子控件，判断如果是有百分比属性，则计算百分比属性，更新视图；
  - 第四步：在布局方法中，遍历子控件，判断是否有百分比属性。如果有则将百分比值更改的原始维度；
  - 第五步：最后调用draw进行绘制。这一步不做任何处理
- 其核心思想就是在第三步
  - 1.以当前ViewGroup为host布局入口，拿到所有的孩子，然后遍历。
  - 2.获取View的layoutParams布局属性，判断是否是百分比布局PercentLayoutParams
  - 3.然后拿到百分比属性，结合当前尺寸，换算出像素单位，并且更新视图。举一个例子，设置百分比padding是15%w，则计算公示：换算像素 = 容器宽度 * 百分比



### 04.Api调用说明



### 05.遇到的坑分析
#### 5.1 解决ScrollView高度
- 描述一下遇到的问题
  - 如果PercentLinearLayout在ScrollView中，那么高度的模式肯定是UNSPECIFIED，那么理论上来说高度是无限制的，也就是依赖于子View的高度。
  - 而百分比布局的高度是依赖于父View的高度的，所有是互斥的。
- 解决办法
  - 考虑到编写代码的时候，大多参考的是屏幕高度（android.R.id.content）的高度，所以如果在ScrollView中，编写10%h，这个百分比是依赖于屏幕高度的。


#### 5.2 子控件超出父容器
- 描述一下遇到的问题
  - 比如一个PercentLinearLayout容器高度是200，这个时候里面的子控件A的高度是15%sh，经过计算后发现该控件高度是240，超出父布局大小呢。
- 解决办法思路
  - 待定



### 06.该库性能分析




### 06.参考博客和项目
- Android 增强版百分比布局库
  - https://blog.csdn.net/lmj623565791/article/details/46767825




